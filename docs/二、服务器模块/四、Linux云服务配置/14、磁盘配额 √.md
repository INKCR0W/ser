---
sidebar_position: 14
---

## 题目
(1)在Linux6主机上添加1块20G硬盘，硬盘文件为1inux6-1.qcow2，保存在根用户家目录，并格式化为ext4文件系统，并开机自动挂载到/data/quota目录下。<br />(2)在1inux6上创建 qu01-qu03等3个用户，用户密码与用户名相同。<br />(3)在/data/quota的存储配额 : root用户硬限制10G，qu01、qu02都配置软限制500MB、硬限制1000MB。<br />(4)当用户qu01在1inux6登录时，系统自动显示当前用户磁盘配额使用情况。<br />(5)实现自动化的配额管理，每天0点0分自动用户qu03的配额限制设置为软限制500M、硬限制1000M。
1小题Server2配置<br />qemu-img create -f qcow2 /root/linux6-1.qcow2 20G            #创建硬盘文件<br />virsh shutdown linux6 	#若qcow2磁盘位于root下，则需要关机才可连接，不在root下，可直接连接<br />virsh attach-disk linux6 /root/linux6-1.qcow2 vdb --persistent --subdriver=qcow2 #连接到linux6，注意：磁盘名不要与linux6现有磁盘重名。<br />chmod 777 /root/	#加权，否则启动不了虚拟机<br />virsh start linux6

Linux6配置<br />lsblk #查看磁盘是否添加<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712386752620-92c92aa1-35a4-4524-aabc-5215dd6340d9.png#averageHue=%23120e0b&clientId=u91b29006-76ba-4&from=paste&height=306&id=LOrrN&originHeight=275&originWidth=805&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=27870&status=done&style=none&taskId=u0ffd186b-ec91-4572-bbaa-f4c589968e9&title=&width=894.444468139131)<br />mkfs.ext4 /dev/vdb   #格式化为ext4<br />vi /etc/fstab  #编辑fstab文件，添加以下内容<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712387222901-565041a7-b5bc-4b64-b0b1-b49ae963268f.png#averageHue=%230e0a07&clientId=u91b29006-76ba-4&from=paste&height=163&id=e86e1&originHeight=147&originWidth=1050&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=26144&status=done&style=none&taskId=uf7f3fb1b-0296-469c-b8f3-c155df91ea4&title=&width=1166.6666975727796)<br />**echo '/dev/vdb /data/quota ext4 defaults 0 0' >> /etc/fstab**<br />mkdir -p /data/quota     #创建挂载点<br />chmod 777 /data/quota #权限给满<br />reboot    				#重启查看挂载结果  
2小题useradd qu01<br />useradd qu02<br />useradd qu03<br />passwd qu01<br />passwd qu02<br />passwd qu03<br />使用id qu01或02或03，可以查看用户是否存在
3小题yum install quota* -y   #安装quota相关的所有包<br />vi /etc/fstab  #将defaults修改为以下内容，让其支持quota<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712394149042-045a42de-afe9-4904-8b83-909fef6dc3bc.png#averageHue=%2316120f&clientId=u91b29006-76ba-4&from=paste&height=168&id=oXMu6&originHeight=151&originWidth=891&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=16905&status=done&style=none&taskId=ua8743ec8-6fcb-4f02-b2ae-e7d0a7272a3&title=&width=990.0000262260444)<br />修改完成之后重启系统，或者重新挂载磁盘<br />quotacheck -auv	#检查磁盘是否支持配置，会生成磁盘配额文件<br />sudo edquota -u root  #改blocks处的hard，修改完后:wq保存退出<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392972260-8ebf294a-fce8-49f3-bc4d-6f2ecf562dbd.png#averageHue=%230d0c0b&clientId=u91b29006-76ba-4&from=paste&height=88&id=AXr7Q&originHeight=79&originWidth=1418&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=9364&status=done&style=none&taskId=u745c6871-3231-4dce-a4a0-08eecc8988a&title=&width=1575.5555972935251)<br />edquota -u qu01  #改blocks处的soft和hard<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392838692-82731747-2cf6-4909-8f71-8fa2acebd000.png#averageHue=%230c0b0a&clientId=u91b29006-76ba-4&from=paste&height=103&id=CZcR7&originHeight=93&originWidth=1430&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=9354&status=done&style=none&taskId=ua952991d-812c-46cf-9c86-f2f178182db&title=&width=1588.8889309800713)<br />edquota -u qu02  #改blocks处的soft和hard<br />![image.png](https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392927568-c3b04380-6776-4ee9-9dd6-8c1ae2ae56c6.png#averageHue=%230e0c0b&clientId=u91b29006-76ba-4&from=paste&height=94&id=NSYR6&originHeight=85&originWidth=1422&originalType=binary&ratio=0.8999999761581421&rotation=0&showTitle=false&size=9413&status=done&style=none&taskId=u29e181dd-9353-49bf-92a1-fe76c9c1ac8&title=&width=1580.0000418557072)<br />注意：这里G和M的换算不一样，结果是系统自己换算出来的，你可以直接输入1G、10G，然后保存，再进去的时候，就会被换算
4小题vi /etc/profile #在尾部添加以下内容<br />if [ "$USER" = "qu01" ]; then<br />quota -v -u; fi
5小题echo '0 0 * * * root edquota -u qu03 -f /data/quota -b 500M 1000M' >> /etc/crontab
