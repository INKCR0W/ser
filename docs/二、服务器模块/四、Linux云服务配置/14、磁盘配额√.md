# 14、磁盘配额 √

## 题目
(1)在Linux6主机上添加1块20G硬盘，硬盘文件为1inux6-1.qcow2，保存在根用户家目录，并格式化为ext4文件系统，并开机自动挂载到/data/quota目录下。

(2)在1inux6上创建 qu01-qu03等3个用户，用户密码与用户名相同。

(3)在/data/quota的存储配额 : root用户硬限制10G，qu01、qu02都配置软限制500MB、硬限制1000MB。

(4)当用户qu01在1inux6登录时，系统自动显示当前用户磁盘配额使用情况。

(5)实现自动化的配额管理，每天0点0分自动用户qu03的配额限制设置为软限制500M、硬限制1000M。

<details class="lake-collapse"><summary id="u0fddc7fb"><span class="ne-text" style="color: #DF2A3F">1小题</span></summary><p id="uffc3c16a" class="ne-p"><span class="ne-text" style="color: #DF2A3F">Server2配置</span><span class="ne-text"><br /></span><span class="ne-text">qemu-img create -f qcow2 /root/linux6-1.qcow2 20G            #创建硬盘文件</span></p><p id="ue9610a8e" class="ne-p"><span class="ne-text">virsh shutdown linux6 	#</span><span class="ne-text" style="color: #DF2A3F">若qcow2磁盘位于root下，则需要关机才可连接</span><span class="ne-text">，不在root下，可直接连接<br /></span><span class="ne-text">virsh attach-disk linux6 /root/linux6-1.qcow2 vdb --persistent --subdriver=qcow2 #连接到linux6，注意：磁盘名不要与linux6现有磁盘重名。</span></p><p id="u627fddc6" class="ne-p"><span class="ne-text">chmod 777 /root/	#</span><span class="ne-text" style="color: #DF2A3F">加权，否则启动不了虚拟机</span></p><p id="uec73e6d8" class="ne-p"><span class="ne-text">virsh start linux6<br /><br /></span><span class="ne-text" style="color: #DF2A3F">Linux6配置</span></p><p id="u58cdb287" class="ne-p"><span class="ne-text">lsblk #查看磁盘是否添加</span></p><p id="u3514ce16" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712386752620-92c92aa1-35a4-4524-aabc-5215dd6340d9.png" width="894.444468139131" id="LOrrN" class="ne-image"></p><p id="u94c7261e" class="ne-p"><span class="ne-text">mkfs.ext4 /dev/vdb   #格式化为ext4</span></p><p id="u4b2ea767" class="ne-p"><span class="ne-text">vi /etc/fstab  #编辑fstab文件，添加以下内容</span></p><p id="u46bf3d34" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712387222901-565041a7-b5bc-4b64-b0b1-b49ae963268f.png" width="1166.6666975727796" id="e86e1" class="ne-image"></p><p id="ucbce3e11" class="ne-p"><strong><span class="ne-text">echo '/dev/vdb /data/quota ext4 defaults 0 0' &gt;&gt; /etc/fstab</span></strong></p><p id="u8b9f6600" class="ne-p"><span class="ne-text">mkdir -p /data/quota     #创建挂载点</span></p><p id="ue2dd9946" class="ne-p"><span class="ne-text">chmod 777 /data/quota #权限给满</span></p><p id="u2274c849" class="ne-p"><span class="ne-text">reboot    				#重启查看挂载结果  </span></p></details>
<details class="lake-collapse"><summary id="u37fbd707"><span class="ne-text" style="color: #DF2A3F">2小题</span></summary><p id="uacf37f22" class="ne-p"><span class="ne-text">useradd qu01</span></p><p id="u4516be6f" class="ne-p"><span class="ne-text">useradd qu02</span></p><p id="u62411383" class="ne-p"><span class="ne-text">useradd qu03</span></p><p id="uda681f1b" class="ne-p"><span class="ne-text">passwd qu01</span></p><p id="u098c0589" class="ne-p"><span class="ne-text">passwd qu02</span></p><p id="uade6bf8d" class="ne-p"><span class="ne-text">passwd qu03</span></p><p id="u095c7b38" class="ne-p"><span class="ne-text">使用id qu01或02或03，可以查看用户是否存在</span></p></details>
<details class="lake-collapse"><summary id="u592ca2f5"><span class="ne-text" style="color: #DF2A3F">3小题</span></summary><p id="u64afb3f3" class="ne-p"><span class="ne-text">yum install quota* -y   #安装quota相关的所有包</span></p><p id="uec18c530" class="ne-p"><span class="ne-text">vi /etc/fstab  #将defaults修改为以下内容，让其支持quota</span></p><p id="uddaf9eaa" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712394149042-045a42de-afe9-4904-8b83-909fef6dc3bc.png" width="990.0000262260444" id="oXMu6" class="ne-image"></p><p id="u49f317da" class="ne-p"><span class="ne-text">修改完成之后重启系统，或者重新挂载磁盘</span></p><p id="ub6bd1773" class="ne-p"><span class="ne-text">quotacheck -auv	#检查磁盘是否支持配置，会生成磁盘配额文件</span></p><p id="u16dc0509" class="ne-p"><span class="ne-text">sudo edquota -u root  #改blocks处的hard，修改完后:wq保存退出</span></p><p id="uf060caec" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392972260-8ebf294a-fce8-49f3-bc4d-6f2ecf562dbd.png" width="1575.5555972935251" id="AXr7Q" class="ne-image"></p><p id="ua5199f02" class="ne-p"><span class="ne-text">edquota -u qu01  #改blocks处的soft和hard</span></p><p id="u7b0193ad" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392838692-82731747-2cf6-4909-8f71-8fa2acebd000.png" width="1588.8889309800713" id="CZcR7" class="ne-image"></p><p id="u1fe9cbfd" class="ne-p"><span class="ne-text">edquota -u qu02  #改blocks处的soft和hard</span></p><p id="u3e88d4f4" class="ne-p"><img src="https://cdn.nlark.com/yuque/0/2024/png/33622884/1712392927568-c3b04380-6776-4ee9-9dd6-8c1ae2ae56c6.png" width="1580.0000418557072" id="NSYR6" class="ne-image"></p><p id="u6234b52d" class="ne-p"><span class="ne-text">注意：这里G和M的换算不一样，结果是系统自己换算出来的，你可以直接输入1G、10G，然后保存，再进去的时候，就会被换算</span></p></details>
<details class="lake-collapse"><summary id="u16bac2fe"><span class="ne-text" style="color: #DF2A3F">4小题</span></summary><p id="uc42d27f7" class="ne-p"><span class="ne-text">vi /etc/profile #在尾部添加以下内容</span></p><p id="u54ac6c23" class="ne-p"><span class="ne-text">if [ &quot;$USER&quot; = &quot;qu01&quot; ]; then</span></p><p id="uced0a76a" class="ne-p"><span class="ne-text">quota -v -u; fi</span></p></details>
<details class="lake-collapse"><summary id="u326ac667"><span class="ne-text" style="color: #DF2A3F">5小题</span></summary><p id="uc11228e0" class="ne-p"><span class="ne-text">echo '0 0 * * * root edquota -u qu03 -f /data/quota -b 500M 1000M' &gt;&gt; /etc/crontab</span></p></details>


> 更新: 2024-04-28 18:57:01  
> 原文: <https://www.yuque.com/gengmouren-1f9qn/whktvz/umzgcizzkbpbhim3>