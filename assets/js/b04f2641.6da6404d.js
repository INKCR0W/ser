"use strict";(self.webpackChunkser=self.webpackChunkser||[]).push([[2854],{9860:(s,i,e)=>{e.r(i),e.d(i,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var n=e(4848),t=e(8453);const r={sidebar_position:9},c=void 0,a={id:"\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/9\u3001iscsi\u670d\u52a1 \u221a",title:"9\u3001iscsi\u670d\u52a1 \u221a",description:"\u9898\u76ee\uff1a",source:"@site/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/9\u3001iscsi\u670d\u52a1 \u221a.md",sourceDirName:"\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e",slug:"/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/9\u3001iscsi\u670d\u52a1 \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/9\u3001iscsi\u670d\u52a1 \u221a",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"8\u3001kubernetes\u670d\u52a1-arm \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/8\u3001kubernetes\u670d\u52a1-arm \u221a"},next:{title:"10\u3001mariadb\u670d\u52a1 \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/10\u3001mariadb\u670d\u52a1 \u221a"}},l={},o=[{value:"<strong>\u9898\u76ee\uff1a</strong>",id:"\u9898\u76ee",level:2},{value:"\u914d\u7f6e\u6b65\u9aa4\uff1a",id:"\u914d\u7f6e\u6b65\u9aa4",level:2},{value:"1\u3001\u6dfb\u52a0\u78c1\u76d8\u3001\u521b\u5efa\u5377\u7ec4\u3001\u521b\u5efa\u903b\u8f91\u5377\u3001\u683c\u5f0f\u5316",id:"1\u6dfb\u52a0\u78c1\u76d8\u521b\u5efa\u5377\u7ec4\u521b\u5efa\u903b\u8f91\u5377\u683c\u5f0f\u5316",level:2},{value:"Server2\u4e2d\u6267\u884c",id:"server2\u4e2d\u6267\u884c",level:3},{value:"linux8\u4e2d\u6267\u884c",id:"linux8\u4e2d\u6267\u884c",level:3},{value:"2\u3001\u914d\u7f6eiscsi\u76ee\u6807\u7aef",id:"2\u914d\u7f6eiscsi\u76ee\u6807\u7aef",level:2},{value:"1\u3001\u914d\u7f6eiscsi\u53d1\u8d77\u7aef---linux9\u4e2d\u6267\u884c",id:"1\u914d\u7f6eiscsi\u53d1\u8d77\u7aef---linux9\u4e2d\u6267\u884c",level:2},{value:"2\u3001\u4fee\u6539rc.load\u6587\u4ef6",id:"2\u4fee\u6539rcload\u6587\u4ef6",level:2},{value:"3\u3001\u9a8c\u8bc1",id:"3\u9a8c\u8bc1",level:2}];function d(s){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...s.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h2,{id:"\u9898\u76ee",children:(0,n.jsx)(i.strong,{children:"\u9898\u76ee\uff1a"})}),"\n",(0,n.jsxs)(i.p,{children:["\uff1a\u8bf7\u91c7\u7528 iscsi\uff0c\u642d\u5efa\u5b58\u50a8\u670d\u52a1\u3002\n1\u3001\u4e3a linux8 \u6dfb\u52a0 4 \u5757\u78c1\u76d8\uff0c\u6bcf\u5757\u78c1\u76d8\u5927\u5c0f\u4e3a 5G\uff0c\u521b\u5efa lvm \u5377\uff0c\u5377\u7ec4\u540d\u79f0\u4e3a vg1\uff0c\u903b\u8f91\u5377\u540d\u79f0\u4e3a lv1\uff0c\u5bb9\u91cf\u4e3a\u5168\u90e8\u7a7a\u95f4\uff0c\u683c\u5f0f\u5316\u4e3a ext4 \u683c\u5f0f\u3002\n2\u3001\u4f7f\u7528/dev/vg1/lv1 \u914d\u7f6e\u4e3a iSCSI \u76ee\u6807\u670d\u52a1\u5668\uff0c\u4e3a linux9 \u63d0\u4f9b iSCSI\u670d\u52a1\u3002iSCSI \u76ee\u6807\u7aef\u7684 wwn \u4e3a iqn.2008-01.lan.skills",":server",",iSCSI\u53d1\u8d77\u7aef\u7684 wwn \u4e3a iqn.2008-01.lan.skills",":client1",".\n3\u3001\u914d\u7f6e linux9 \u4e3a iSCSI \u5ba2\u6237\u7aef\uff0c\u5b9e\u73b0 discovery chap \u548c session chap\u53cc\u5411\u8ba4\u8bc1\uff0cTarget \u8ba4\u8bc1\u7528\u6237\u540d\u4e3a IncomingUser\uff0c\u5bc6\u7801\u4e3a IncomingPass\uff1bInitiator \u8ba4\u8bc1\u7528\u6237\u540d\u4e3a OutgoingUser\uff0c\u5bc6\u7801\u4e3a OutgoingPass\u3002\n4\u3001\u4fee\u6539/etc/rc.d/rc.local \u6587\u4ef6\u5f00\u673a\u81ea\u52a8\u6302\u8f7d iscsi \u78c1\u76d8\u5230/iscsi \u76ee\u5f55\u3002\n\u6ce8\uff1a\u53d1\u73b0\u8ba4\u8bc1\uff1aDiscovery CHAP\u53d1\u751f\u5728iSCSI\u4f1a\u8bdd\u5efa\u7acb\u4e4b\u524d\uff0c\u7528\u4e8e\u63a7\u5236\u54ea\u4e9binitiator\u53ef\u4ee5\u53d1\u73b0target\u3002\n\u4f1a\u8bdd\u8ba4\u8bc1\uff1aSession CHAP\u5219\u662f\u5728\u4f1a\u8bdd\u5efa\u7acb\u65f6\u8fdb\u884c\uff0c\u7528\u4e8e\u63a7\u5236\u54ea\u4e9binitiator\u53ef\u4ee5\u4e0etarget\u5efa\u7acb\u4f1a\u8bdd\u3002"]}),"\n",(0,n.jsx)(i.h2,{id:"\u914d\u7f6e\u6b65\u9aa4",children:"\u914d\u7f6e\u6b65\u9aa4\uff1a"}),"\n",(0,n.jsx)(i.h1,{id:"1\u5c0f\u9898",children:"1\u5c0f\u9898"}),"\n",(0,n.jsx)(i.h2,{id:"1\u6dfb\u52a0\u78c1\u76d8\u521b\u5efa\u5377\u7ec4\u521b\u5efa\u903b\u8f91\u5377\u683c\u5f0f\u5316",children:"1\u3001\u6dfb\u52a0\u78c1\u76d8\u3001\u521b\u5efa\u5377\u7ec4\u3001\u521b\u5efa\u903b\u8f91\u5377\u3001\u683c\u5f0f\u5316"}),"\n",(0,n.jsx)(i.h3,{id:"server2\u4e2d\u6267\u884c",children:"Server2\u4e2d\u6267\u884c"}),"\n",(0,n.jsx)(i.p,{children:"qemu-img create -f qcow2 /cp/b.qcow2 5G\nqemu-img create -f qcow2 /cp/c.qcow2 5G\nqemu-img create -f qcow2 /cp/d.qcow2 5G\nqemu-img create -f qcow2 /cp/e.qcow2 5G"}),"\n",(0,n.jsx)(i.p,{children:"virsh attach-disk linux8 /cp/b.qcow2 vdb --persistent --subdriver=qcow2\nvirsh attach-disk linux8 /cp/c.qcow2 vdc --persistent --subdriver=qcow2\nvirsh attach-disk linux8 /cp/d.qcow2 vdd --persistent --subdriver=qcow2\nvirsh attach-disk linux8 /cp/e.qcow2 vde --persistent --subdriver=qcow2"}),"\n",(0,n.jsx)(i.h3,{id:"linux8\u4e2d\u6267\u884c",children:"linux8\u4e2d\u6267\u884c"}),"\n",(0,n.jsxs)(i.p,{children:["fdisk -l\u6216lsblk\u67e5\u770b\u78c1\u76d8\u4fe1\u606f\n",(0,n.jsx)(i.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1682829630957-8e5bbe9f-16d6-404d-be6c-df7eaaa164c0.png#averageHue=%23040200&clientId=u8c9a9024-477c-4&from=paste&height=643&id=rrdQK&originHeight=643&originWidth=813&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74153&status=done&style=none&taskId=u40b99ecc-9b4f-4c82-b3c8-67ab0293beb&title=&width=813",alt:"image.png"}),"\nvgcreate vg1 /dev/vdb /dev/vdc /dev/vdd /dev/vde   #\u5c06\u6240\u6709\u76f8\u5173\u7269\u7406\u5377\u52a0\u5165\u5377\u7ec4 \u67e5\u770b\u7ed3\u679c\uff1avgdisplay\n",(0,n.jsx)(i.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1682829871138-702f4856-d4f0-4e50-8de0-aac2a780e50d.png#averageHue=%230a0600&clientId=u8c9a9024-477c-4&from=paste&height=121&id=C6UrJ&originHeight=121&originWidth=929&originalType=binary&ratio=1&rotation=0&showTitle=false&size=15170&status=done&style=none&taskId=uc15b9dc0-0f9f-4c64-ac0e-42bf3e6eedc&title=&width=929",alt:"image.png"}),"\nlvcreate -l +100%free vg1 -n lv1 #\u5212\u5206\u5168\u90e8\u7a7a\u95f4\u5230\u903b\u8f91\u5377\uff0c\u540d\u79f0\u4e3alv1   \u67e5\u770b\u7ed3\u679c\uff1alvdisplay\nmkfs.ext4 /dev/vg1/lv1 #\u683c\u5f0f\u5316\u903b\u8f91\u5377\u4e3aext4\u683c\u5f0f"]}),"\n",(0,n.jsx)(i.h2,{id:"2\u914d\u7f6eiscsi\u76ee\u6807\u7aef",children:"2\u3001\u914d\u7f6eiscsi\u76ee\u6807\u7aef"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"[root@linux8 ~]# targetcli\n/backstores/block create vg1 /dev/vg1/lv1 #\u6307\u5b9a\u8981\u53d1\u5e03\u5171\u4eab\u7684\u78c1\u76d8\uff0c\u6216\u8005\u8bf4\u521b\u5efa\u5757\u8bbe\u5907\n/iscsi/ create wwn=iqn.2023-08.lan.skills:server #\u521b\u5efaiSCSI\u76ee\u6807\n/iscsi/iqn.2023-08.lan.skills:server/tpg1/luns create /backstores/block/vg1 #\u914d\u7f6eluns\n/iscsi/iqn.2023-08.lan.skills:server/tpg1/acls create iqn.2023-08.lan.skills:client #\u914d\u7f6eacls\uff0c\u6307\u5b9a\u53d1\u8d77\u7aef\u7684iqn\n\n/iscsi/iqn.2023-08.lan.skills:server/tpg1/portals/ delete 0.0.0.0 3260 #\u5220\u9664\u9ed8\u8ba4\u7684\u5168\u90e8\u4fa6\u542c\n/iscsi/iqn.2023-08.lan.skills:server/tpg1/portals/ create 10.4.220.108 3260 #\u6307\u5b9a\u4fa6\u542c\u7684IP\n\n/iscsi set discovery_auth enable=1 userid=IncomingUser password=IncomingPass mutual_userid=OutgoingUser mutual_password=OutgoingPass  #\u542f\u7528\u8ba4\u8bc1\u53d1\u73b0\u529f\u80fd\uff0c\u914d\u7f6e\u53d1\u73b0\u8ba4\u8bc1\u548c\u4f1a\u8bdd\u8ba4\u8bc1\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\n/iscsi/iqn.2023-08.lan.skills:server/tpg1/acls/iqn.2023-08.lan.skills:client/ set auth userid=IncomingUser password=IncomingPass mutual_userid=OutgoingUser mutual_password=OutgoingPass #\u914d\u7f6e\u53d1\u8d77\u7aef\u53d1\u73b0\u8ba4\u8bc1\u548c\u4f1a\u8bdd\u8ba4\u8bc1\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\n\u6ce8\uff1auserid\u662f\u8bbe\u7f6eiSCSI\u5ba2\u6237\u7aef\u8fde\u63a5\u5230iSCSI\u76ee\u6807\u65f6\u9700\u8981\u63d0\u4f9b\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\n    mutual\u662f\u8bbe\u7f6eiSCSI\u76ee\u6807\u5728\u4e0e\u5ba2\u6237\u7aef\u5efa\u7acb\u4f1a\u8bdd\u65f6\u9700\u8981\u63d0\u4f9b\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\n\n/iscsi/ get discovery_auth #\u67e5\u770bdiscovery_auth\u914d\u7f6e\u7ed3\u679c\nsaveconfig \t\t\t\t\t\t\t\t\t#\u4fdd\u5b58\u914d\u7f6e\nexit \t\t\t\t\t\t\t\t\t\t\t\t#\u9000\u51fatargetcli\u6a21\u5f0f\n"})}),"\n",(0,n.jsx)(i.h1,{id:"2\u5c0f\u9898",children:"2\u5c0f\u9898"}),"\n",(0,n.jsx)(i.h2,{id:"1\u914d\u7f6eiscsi\u53d1\u8d77\u7aef---linux9\u4e2d\u6267\u884c",children:"1\u3001\u914d\u7f6eiscsi\u53d1\u8d77\u7aef---linux9\u4e2d\u6267\u884c"}),"\n",(0,n.jsxs)(i.p,{children:["yum install iscsi* -y\nsystemctl restart iscsid\ncd /etc/iscsi/\nvi initiatorname.iscsi #\u914d\u7f6e\u53d1\u8d77\u7aef\u540d\u79f0InitiatorName=iqn.2023-08.lan.skills",":client","\nvi iscsi.conf #\u914d\u7f6eCHAP\u8ba4\u8bc1\u5bc6\u94a5\u57fa\u672c\u903b\u8f91\uff1aI\u8fdeT\uff0cI\u63d0\u4f9bT\u7aef\u9884\u8bbe\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c  T\u54cd\u5e94I\uff0cI\u63d0\u4f9bT\u7aef\u9884\u8bbe\u7684I\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\nnode.session.auth.authmethod = CHAP #\u5141\u8bb8\u4f1a\u8bdd\u8ba4\u8bc1\n\u53d1\u8d77\u7aef\uff08Initiator\uff09\u8fde\u63a5\u5230\u76ee\u6807\u7aef\uff08Target\uff09\u65f6\u4f7f\u7528\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\nnode.session.auth.username = IncomingUser\nnode.session.auth.password = IncomingPass"]}),"\n",(0,n.jsx)(i.p,{children:"\u76ee\u6807\u7aef\uff08Target\uff09\u5728\u54cd\u5e94\u53d1\u8d77\u7aef\uff08Initiator\uff09\u7684\u8fde\u63a5\u8bf7\u6c42\u65f6\u4f7f\u7528\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\nnode.session.auth.username_in = OutgoingUser\nnode.session.auth.password_in = OutgoingPass"}),"\n",(0,n.jsx)(i.p,{children:"discovery.sendtargets.auth.authmethod = CHAP #\u5141\u8bb8\u53d1\u73b0\u8ba4\u8bc1\n\u53d1\u8d77\u7aef\uff08Initiator\uff09\u5728\u5bfb\u627e\u76ee\u6807\u7aef\uff08Target\uff09\u65f6\u4f7f\u7528\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\ndiscovery.sendtargets.auth.username = IncomingUser\ndiscovery.sendtargets.auth.password = IncomingPass\n\u76ee\u6807\u7aef\uff08Target\uff09\u5728\u54cd\u5e94\u53d1\u8d77\u7aef\uff08Initiator\uff09\u7684\u53d1\u73b0\u8bf7\u6c42\u65f6\u4f7f\u7528\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\ndiscovery.sendtargets.auth.username_in = OutgoingUser\ndiscovery.sendtargets.auth.password_in = OutgoingPass"}),"\n",(0,n.jsxs)(i.p,{children:["systemctl restart iscsid #\u91cd\u542fiscsi\u670d\u52a1\u8ba9\u521a\u521a\u7684\u914d\u7f6e\u751f\u6548\niscsiadm -m discovery -t sendtargets -p 10.1.220.108 #\u641c\u7d22\u5b58\u50a8\niscsiadm -m node -T iqn.2023-08.lan.skills",":server"," -p 10.1.220.108 --login #\u8fde\u63a5\u8fd9\u4e2a\u641c\u7d22\u5230\u7684IQN\niscsiadm -m session -o show #\u67e5\u770b\u8fde\u63a5\u60c5\u51b5"]}),"\n",(0,n.jsx)(i.p,{children:"\u4f7f\u7528lsblk\u67e5\u770b\u662f\u5426\u6709\u4e00\u4e2a20G\u7684\u78c1\u76d8\u51fa\u73b0\u3002"}),"\n",(0,n.jsx)(i.h2,{id:"2\u4fee\u6539rcload\u6587\u4ef6",children:"2\u3001\u4fee\u6539rc.load\u6587\u4ef6"}),"\n",(0,n.jsxs)(i.p,{children:["vi /etc/rc.d/rc.localtouch /var/lock/subsys/local\n",(0,n.jsx)(i.strong,{children:"sudo mount /dev/sda   /iscsi"}),"\nchmod +x /etc/rc.d/rc.local\nmkdir  /iscsi"]}),"\n",(0,n.jsx)(i.h2,{id:"3\u9a8c\u8bc1",children:"3\u3001\u9a8c\u8bc1"}),"\n",(0,n.jsx)(i.p,{children:"\u91cd\u542flinux9\uff0c\u4f7f\u7528df -h\u547d\u4ee4\u67e5\u770b\u91cd\u542f\u540e\u662f\u5426\u81ea\u52a8\u6302\u8f7dsda\u78c1\u76d8\u5230iscsi\u76ee\u5f55"})]})}function u(s={}){const{wrapper:i}={...(0,t.R)(),...s.components};return i?(0,n.jsx)(i,{...s,children:(0,n.jsx)(d,{...s})}):d(s)}},8453:(s,i,e)=>{e.d(i,{R:()=>c,x:()=>a});var n=e(6540);const t={},r=n.createContext(t);function c(s){const i=n.useContext(r);return n.useMemo((function(){return"function"==typeof s?s(i):{...i,...s}}),[i,s])}function a(s){let i;return i=s.disableParentContext?"function"==typeof s.components?s.components(t):s.components||t:c(s.components),n.createElement(r.Provider,{value:i},s.children)}}}]);