"use strict";(self.webpackChunkser=self.webpackChunkser||[]).push([[6358],{1919:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var t=i(4848),r=i(8453);const s={sidebar_position:8},a=void 0,l={id:"\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/8\u3001kubernetes\u670d\u52a1-arm \u221a",title:"8\u3001kubernetes\u670d\u52a1-arm \u221a",description:"\u9898\u76ee\uff1a",source:"@site/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/8\u3001kubernetes\u670d\u52a1-arm \u221a.md",sourceDirName:"\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e",slug:"/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/8\u3001kubernetes\u670d\u52a1-arm \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/8\u3001kubernetes\u670d\u52a1-arm \u221a",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"7\u3001nfs\u670d\u52a1 \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/7\u3001nfs\u670d\u52a1 \u221a"},next:{title:"9\u3001iscsi\u670d\u52a1 \u221a",permalink:"/docs/\u4e8c\u3001\u670d\u52a1\u5668\u6a21\u5757/\u56db\u3001Linux\u4e91\u670d\u52a1\u914d\u7f6e/9\u3001iscsi\u670d\u52a1 \u221a"}},c={},d=[{value:"<strong>\u9898\u76ee\uff1a</strong>",id:"\u9898\u76ee",level:2},{value:"\u914d\u7f6e\u6b65\u9aa4\uff1a",id:"\u914d\u7f6e\u6b65\u9aa4",level:2},{value:"\u51c6\u5907\u5de5\u4f5c--\u6240\u6709\u8282\u70b9",id:"\u51c6\u5907\u5de5\u4f5c--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5kubernetes--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u4e00\u6b65\u5b89\u88c5kubernetes--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u4e8c\u6b65\uff1a\u8c03\u6574\u5185\u6838\u53c2\u6570--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u4e8c\u6b65\u8c03\u6574\u5185\u6838\u53c2\u6570--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u4e09\u6b65\uff1aKubelet\u9a71\u52a8\u914d\u7f6e--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u4e09\u6b65kubelet\u9a71\u52a8\u914d\u7f6e--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u56db\u6b65\uff1a\u5bfc\u5165\u955c\u50cf--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u56db\u6b65\u5bfc\u5165\u955c\u50cf--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u4e94\u6b65\uff1a\u914d\u7f6econtainerd--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u4e94\u6b65\u914d\u7f6econtainerd--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u516d\u6b65\uff1a\u521d\u59cb\u5316\u96c6\u7fa4--\u4e3b\u8282\u70b9",id:"\u7b2c\u516d\u6b65\u521d\u59cb\u5316\u96c6\u7fa4--\u4e3b\u8282\u70b9",level:2},{value:"\u7b2c\u516d\u6b65\uff1a\u52a0\u5165\u96c6\u7fa4--\u5de5\u4f5c\u8282\u70b9",id:"\u7b2c\u516d\u6b65\u52a0\u5165\u96c6\u7fa4--\u5de5\u4f5c\u8282\u70b9",level:2},{value:"\u7b2c\u4e00\u6b65\uff1a\u521b\u5efacalico\u7f51\u7edc--\u4e3b\u8282\u70b9",id:"\u7b2c\u4e00\u6b65\u521b\u5efacalico\u7f51\u7edc--\u4e3b\u8282\u70b9",level:2},{value:"\u7b2c\u4e00\u6b65\uff1a\u5bfc\u5165nginx\u955c\u50cf--\u6240\u6709\u8282\u70b9",id:"\u7b2c\u4e00\u6b65\u5bfc\u5165nginx\u955c\u50cf--\u6240\u6709\u8282\u70b9",level:2},{value:"\u7b2c\u4e8c\u6b65\uff1a\u521b\u5efa\u90e8\u7f72--\u4e3b\u8282\u70b9",id:"\u7b2c\u4e8c\u6b65\u521b\u5efa\u90e8\u7f72--\u4e3b\u8282\u70b9",level:2},{value:"\u7b2c\u4e09\u6b65\uff1a\u6620\u5c04\u7aef\u53e3--\u4e3b\u8282\u70b9",id:"\u7b2c\u4e09\u6b65\u6620\u5c04\u7aef\u53e3--\u4e3b\u8282\u70b9",level:2},{value:"\u7b2c\u56db\u6b65\uff1a\u4f7f\u7528kubectl\u914d\u7f6enginx--\u4e3b\u8282\u70b9",id:"\u7b2c\u56db\u6b65\u4f7f\u7528kubectl\u914d\u7f6enginx--\u4e3b\u8282\u70b9",level:2},{value:"\u7b2c\u4e94\u6b65\uff1a\u6d4b\u8bd5--\u4e3b\u8282\u70b9",id:"\u7b2c\u4e94\u6b65\u6d4b\u8bd5--\u4e3b\u8282\u70b9",level:2}];function o(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u9898\u76ee",children:(0,t.jsx)(n.strong,{children:"\u9898\u76ee\uff1a"})}),"\n",(0,t.jsx)(n.p,{children:"\u8bf7\u91c7\u7528 kubernetes \u548c containerd\uff0c\u7ba1\u7406\u5bb9\u5668\u3002\n1\u3001\u5728 linux5-linux7 \u4e0a\u5b89\u88c5 containerd \u548c kubernetes\uff0clinux5 \u4f5c\u4e3amaster node \uff0c linux6 \u548c linux7 \u4f5c \u4e3a work node \uff1b \u4f7f \u7528 containerd.sock \u4f5c \u4e3a \u5bb9 \u5668 runtime-endpoint \u3002 pod \u7f51 \u7edc \u4e3a10.244.0.0/16\uff0cservices \u7f51\u7edc\u4e3a 10.96.0.0/16\u3002\n**2\u3001**master \u8282\u70b9\u914d\u7f6e calico \u4f5c\u4e3a\u7f51\u7edc\u7ec4\u4ef6\u3002\n3\u3001\u5bfc\u5165 nginx.tar \u955c\u50cf\uff0c\u4e3b\u9875\u5185\u5bb9\u4e3a\u201cHelloKubernetes\u201d\u3002\u7528\u8be5\u955c\u50cf\u521b\n\u5efa\u4e00\u4e2a\u540d\u79f0\u4e3a web \u7684 deployment\uff08\u90e8\u7f72\uff09\uff0c\u526f\u672c\u6570\u4e3a 2\uff1b\u4e3a\u8be5 deployment \u521b\n\u5efa\u4e00\u4e2a\u7c7b\u578b\u4e3a nodeport \u7684 service\uff0cport \u4e3a 80\uff0ctargetPort \u4e3a 80\uff0c\nnodePort \u4e3a 30000\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u914d\u7f6e\u6b65\u9aa4",children:"\u914d\u7f6e\u6b65\u9aa4\uff1a"}),"\n",(0,t.jsx)(n.h2,{id:"\u51c6\u5907\u5de5\u4f5c--\u6240\u6709\u8282\u70b9",children:"\u51c6\u5907\u5de5\u4f5c--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:'1\u3001\u7981\u7528\u4ea4\u6362\u5206\u533a\uff0c\u4fdd\u8bc1kubelet\u6b63\u5e38\u5de5\u4f5c    vi /etc/fstab #\u4fee\u6539fstab\u6587\u4ef6\uff0c\u6ce8\u91ca\u6389\u4ea4\u6362\u5206\u533a\necho "vm.swappiness = 0" >> /etc/sysctl.conf #\u4f7f\u5176\u6c38\u4e45\u4e0d\u5206\u914d\nswapoff -a #\u4e34\u65f6\u5173\u95ed\n2\u3001\u5173\u95ed\u9632\u706b\u5899\u6216\u653e\u884c\u670d\u52a1    systemctl stop firewalld #\u5173\u95ed\u9632\u706b\u5899\nsystemctl disable firewalld #\u5f00\u673a\u4e0d\u81ea\u542f\n\u9664\u4e86\u5173\u95ed\u5916\uff0c\u4e5f\u53ef\u4ee5\u653e\u884c\u76f8\u5e94\u670d\u52a1\nfirewall-cmd --permanent --add-service=kadmin\n3\u3001\u5173\u95ed selinux     vi /etc/selinux/config #\u5c06enabled\u6539\u4e3adisabled\nsetenforce 0 #\u4e34\u65f6\u5173\u95ed\n4\u3001\u4fee\u6539 hosts \u6587\u4ef6\uff08\u53ef\u4e0d\u505a\uff09vi /etc/hosts #\u8282\u70b9IP\u4e0e\u57df\u540d\u505a\u5bf9\u5e94\u5173\u7cfb\nlinux5\t10.4.220.105\tlinux5.skills.lan\nlinux6\t10.4.220.106\tlinux6.skills.lan\nlinux7\t10.4.220.107\tlinux7.skills.lan\n5\u3001\u786e\u4fdd chrony \u65f6\u95f4\u670d\u52a1\u540c\u6b65\u6b63\u5e38    vi /etc/chonryd.config #\u7f16\u8f91chrony\u670d\u52a1\u914d\u7f6e\u6587\u4ef6\nsystemctl restart chronyd #\u91cd\u542f\u65f6\u95f4\u670d\u52a1\ndate #\u67e5\u770b\u5f53\u524d\u65f6\u95f4\n6\u3001\u8bc1\u4e66\u548c\u8bc1\u4e66\u79c1\u94a5\u53d1\u9001\u81f3Linux5'}),"\n",(0,t.jsx)(n.h1,{id:"1\u5c0f\u9898",children:"1\u5c0f\u9898"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e00\u6b65\u5b89\u88c5kubernetes--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u4e00\u6b65\uff1a\u5b89\u88c5kubernetes--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["1\u3001\u89e3\u538b\u5e76\u5b89\u88c5\u6240\u6709rpm\u5305",(0,t.jsx)(n.br,{}),"\n","tar -xf  kubernetes.tar\ncd /kubernetes/packages\nrpm -Uvh --force --nodeps *.rpm\u6216\u8005yum install *.rpm\n\u4f7f\u7528yum\u53ef\u4ee5\u628a\u5176\u4ed6\u4f9d\u8d56\u5305\u4e00\u5e76\u5b89\u88c5\uff0c\u524d\u63d0\u662fyum\u672c\u5730\u6e90\u8981\u6b63\u5e38"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"source <(kubectl completion bash)  #\u914d\u7f6ekubernetes tab\u8865\u5168\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e8c\u6b65\u8c03\u6574\u5185\u6838\u53c2\u6570--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u4e8c\u6b65\uff1a\u8c03\u6574\u5185\u6838\u53c2\u6570--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u5199\u5165\u5185\u5bb91:    \u4e3aKubernetes\u63d0\u4f9b\u6240\u9700\u7684\u5e95\u5c42\u652f\u6301cat <<EOF | tee /etc/modules-load.d/k.conf\noverlay\nbr_netfilter\nEOF\nmodprobe overlay #\u52a0\u8f7d\u6a21\u5757\nmodprobe br_netfilter #\u52a0\u8f7d\u6a21\u5757\n\u5199\u5165\u5185\u5bb92\uff1a\u4f7f\u7f51\u7edc\u53ef\u4ee5\u6b63\u5e38\u5904\u7406\u548c\u8f6c\u53d1cat <<EOF | tee /etc/sysctl.d/k.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward = 1\nEOF\nsysctl -p --system #\u91cd\u8f7d\u5185\u6838\u53c2\u6570\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e09\u6b65kubelet\u9a71\u52a8\u914d\u7f6e--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u4e09\u6b65\uff1aKubelet\u9a71\u52a8\u914d\u7f6e--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:'vi /etc/sysconfig/kubeletKUBELET_CGROUP_ARGS="--cgroup-driver=systemd"  #Kubelet\u4f7f\u7528systemd\u4f5c\u4e3acgroup\u9a71\u52a8\n\u6ce8\u914d\u7f6eKubelet\u4f7f\u7528systemd\u4f5c\u4e3acgroup\u9a71\u52a8\uff0c\u53ef\u4ee5\u786e\u4fdd\u5728\u4e0d\u540c\u73af\u5883\u4e0b\u7684\u517c\u5bb9\u6027\uff0c\u4f8b\u5982x86\u548carm\n\u5728Kubernetes\u4e2d\uff0ccgroup\u88ab\u7528\u6765\u7ba1\u7406Pod\u548c\u5bb9\u5668\u7684\u8d44\u6e90\u4f7f\u7528\u3002\nsystemctl enable --now containerd.service kubelet.service #\u8bbe\u4e3a\u5f00\u673a\u81ea\u542f\uff0c\u5e76\u73b0\u5728\u542f\u52a8'}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u56db\u6b65\u5bfc\u5165\u955c\u50cf--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u56db\u6b65\uff1a\u5bfc\u5165\u955c\u50cf--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:['cd \u5207\u6362\u5230\u955c\u50cf\u6240\u5728\u76ee\u5f55\nctr -n k8s.io image import +  \u955c\u50cf\u540d  --platform=linux/arm64   #\u5355\u4e2a\u5bfc\u5165\u955c\u50cf\u5230\u6307\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\nfor i in *;do ctr -n k8s.io i import $i --platform=linux/arm64 ;done #\u6279\u91cf\u5bfc\u5165\nctr -n k8s.io i list -q  #\u5217\u51fa\u547d\u540d\u7a7a\u95f4\u4e3a "k8s.io" \u7684\u6240\u6709\u955c\u50cfID\uff0c\u955c\u50cf\u4f4d\u7f6e\u4e0econfig.toml\u5bf9\u5e94\n\u6ce8kubeadm config images list #\u67e5\u770b\u6240\u9700\u955c\u50cf\u5217\u8868',(0,t.jsx)(n.br,{}),"\n","ctr namespace ls \u67e5\u770b\u6240\u6709\u547d\u540d\u7a7a\u95f4"]}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e94\u6b65\u914d\u7f6econtainerd--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u4e94\u6b65\uff1a\u914d\u7f6econtainerd--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["\u4fee\u6539containerd\u914d\u7f6e\u6587\u4ef6",(0,t.jsx)(n.br,{}),"\n","containerd config default | tee > /etc/containerd/config.toml #\u751f\u6210containerd\u914d\u7f6e\u6587\u4ef6"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'\u4fee\u65391\uff1a[plugins."io.containerd.grpc.v1.cri"]\nsandbox_image = "reqistry.aliyuncs.com/google_containers/pause:3.9"\u4e0e\u8981\u5b89\u88c5\u7684pause\u7248\u672c\u5bf9\u5e94\n\n\u4fee\u65392\uff1a[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]\nSystemdCgroup = true\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u914d\u7f6econtainerd.sock \u4f5c\u4e3a\u5bb9\u5668 runtime-endpoint\ncrictl config runtime-endpoint /run/containerd/containerd.sock"}),"\n",(0,t.jsx)(n.p,{children:"systemctl restart containerd.service kubelet.service #\u91cd\u542fcontnainerd\u548ckubelet"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u516d\u6b65\u521d\u59cb\u5316\u96c6\u7fa4--\u4e3b\u8282\u70b9",children:"\u7b2c\u516d\u6b65\uff1a\u521d\u59cb\u5316\u96c6\u7fa4--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:"kubeadm config print init-defaults > kubA.yaml\u5bfc\u51fa\u521d\u59cb\u5316\u914d\u7f6e\u4fe1\u606f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"advertiseAddress: 10.4.220.105 #\u4e3b\u8282\u70b9IP\nimagePullPolicy: Never #\u672c\u5730\u62c9\u53d6\u955c\u50cf\nname: linux5 #\u4e3b\u8282\u70b9\u4e3b\u673a\u540d/\u57df\u540d/IP\nkubernetesVersion: 1.27.1 #\u6307\u5b9akubernetes\u5177\u4f53\u7248\u672c\nserviceSubnet: 10.96.0.0/16\npodSubnet: 10.244.0.0/16\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6ce8imagePullPolicy\u53ef\u4ee5\u6709\u4e09\u79cd\u9009\u9879"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Always"}),"\uff1a\u6b64\u7b56\u7565\u8868\u793a\u6bcf\u6b21Pod\u542f\u52a8\u65f6\uff0c\u65e0\u8bba\u8282\u70b9\u4e0a\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u6307\u5b9a\u7248\u672c\u7684\u955c\u50cf\uff0c\u90fd\u4f1a\u5c1d\u8bd5\u4ece\u8fdc\u7a0b\u955c\u50cf\u4ed3\u5e93\u62c9\u53d6\u6700\u65b0\u7684\u955c\u50cf\u3002\u5982\u679c\u672c\u5730\u5df2\u7ecf\u5b58\u5728\u8be5\u955c\u50cf\uff0c\u4e5f\u4f1a\u91cd\u65b0\u62c9\u53d6\u5e76\u8986\u76d6\u672c\u5730\u7684\u955c\u50cf\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"IfNotPresent"}),"\uff1a\u8fd9\u662fimagePullPolicy\u7684\u9ed8\u8ba4\u503c\u3002\u5728\u6b64\u7b56\u7565\u4e0b\uff0c\u5982\u679c\u8282\u70b9\u4e0a\u4e0d\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u5219\u5c06\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u62c9\u53d6\u3002\u5982\u679c\u8282\u70b9\u4e0a\u5df2\u7ecf\u5b58\u5728\u8be5\u955c\u50cf\uff0c\u5219\u4e0d\u4f1a\u62c9\u53d6\u65b0\u7684\u955c\u50cf\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Never"}),"\uff1a\u6b64\u7b56\u7565\u610f\u5473\u7740Pod\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u4ece\u8fdc\u7a0b\u955c\u50cf\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf\uff0c\u53ea\u4f1a\u4f7f\u7528\u8282\u70b9\u4e0a\u5df2\u7ecf\u5b58\u5728\u7684\u955c\u50cf\u3002\u5982\u679c\u8282\u70b9\u4e0a\u4e0d\u5b58\u5728\u6307\u5b9a\u7684\u955c\u50cf\uff0c\u5219\u5bb9\u5668\u65e0\u6cd5\u542f\u52a8\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"kubeadm init --config=kubA.yaml #\u9009\u62e9\u8be5\u6587\u4ef6\u8fdb\u884c\u521d\u59cb\u5316\u96c6\u7fa4\n\u521d\u59cb\u5316\u5b8c\u6210\u540e\u624b\u52a8\u590d\u5236\u6267\u884c\u4ee5\u4e0b\u5185\u5bb9mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u516d\u6b65\u52a0\u5165\u96c6\u7fa4--\u5de5\u4f5c\u8282\u70b9",children:"\u7b2c\u516d\u6b65\uff1a\u52a0\u5165\u96c6\u7fa4--\u5de5\u4f5c\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:"1\u3001\u4e3b\u8282\u70b9\u521d\u59cb\u5316\u5b8c\u6210\u540e\u4f1a\u751f\u6210\u7c7b\u4f3c\u4e0b\u65b9\u7684\u6307\u4ee4\uff0c\u628a\u8be5\u5185\u5bb9\u590d\u5236\u5230\u5de5\u4f5c\u8282\u70b9\u6267\u884c\uff0c\u5373\u53ef\u52a0\u5165\u96c6\u7fa4\nkubeadm join 10.4.220.105:6443 --token abcdef.0123456789abcdef \\"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"--discovery-token-ca-cert-hash sha256:8d987951412a23a94c7a131c99d39d0b0dd2596d7c80850033da30ad3874f367"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"kubectl get nodes #\u5728\u4e3b\u8282\u70b9\u6267\u884c\uff0c\u53ef\u4ee5\u67e5\u770b\u52a0\u5165\u60c5\u51b5\nkubectl get pods --all-namespaces #\u67e5\u770b\u6240\u6709\u955c\u50cf\u8fd0\u884c\u60c5\u51b5"}),"\n",(0,t.jsx)(n.h1,{id:"2\u5c0f\u9898",children:"2\u5c0f\u9898"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e00\u6b65\u521b\u5efacalico\u7f51\u7edc--\u4e3b\u8282\u70b9",children:"\u7b2c\u4e00\u6b65\uff1a\u521b\u5efacalico\u7f51\u7edc--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:"cat kubA.yaml\n\u627e\u5230podSubnet: \u5c06\u7f51\u7edc\u4fe1\u606f\u590d\u5236"}),"\n",(0,t.jsxs)(n.p,{children:["cd /kubernetes/calico/\nvi calico.yaml #\u5728\u8be5\u6587\u4ef6\u4e0b\u5206\u522b\u641c\u7d22 k8s,bgp\u548cno effect\n\u5728k8s,bgp\u4e0b\u6dfb\u52a0\u4e24\u884c\uff0censp1s0\u4e3a\u7f51\u5361\u540d\u79f0\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704784385501-8c71353c-eaeb-4b02-83fc-0b225c843a63.png#averageHue=%23310b25&clientId=u14b596dc-9e8a-4&from=paste&height=203&id=gD61W&originHeight=203&originWidth=803&originalType=binary&ratio=1&rotation=0&showTitle=false&size=49377&status=done&style=none&taskId=u30d489b5-461a-4562-be08-19ccdd3d21e&title=&width=803",alt:"image.png"}),"\n\u5728no effect\u4e0b\u53d6\u6d88\u6ce8\u91ca\u5e76\u8fdb\u884c\u4ee5\u4e0b\u4fee\u6539\uff0c10.244.0.0\u4e3a\uff0ckubA\u4e2d\u7684pods\u7f51\u7edc\u4fe1\u606f\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704784529827-64224441-fa7a-4e9f-9c8b-e922001a7b59.png#averageHue=%23310b25&clientId=u14b596dc-9e8a-4&from=paste&height=109&id=u8966d942&originHeight=109&originWidth=866&originalType=binary&ratio=1&rotation=0&showTitle=false&size=31631&status=done&style=none&taskId=u6cb06c27-295d-49aa-b26d-02fdd9b9e84&title=&width=866",alt:"image.png"}),"\n\u6ce8\u610f\uff01\uff01\uff01\uff0123\u5e74\u56fd\u8d5b\u6d89\u53ca\u7684calico\u76f8\u5173\u7684\u955c\u50cf\u7248\u672c\u5982\u4e0b\ncni-v3.25.0.tar\nkube-controllers-v3.25.0.tar\nnode-v3.25.0.tar"]}),"\n",(0,t.jsx)(n.p,{children:"\u82e5calico.yaml\u6587\u4ef6\u4e2d\u7684\u7248\u672c\u4e0e\u4ee5\u4e0a\u4e0d\u540c\uff0c\u9700\u8981\u81ea\u5df1\u4fee\u6539\u4e3a3.25.0\uff0carm\u67b6\u6784\u7684\u4fee\u6539\u4e3a3.25.0-arm\nkubectl apply -f calico.yaml \u521b\u5efa\u7f51\u7edc\u7ec4\u4ef6\u811a\u672c"}),"\n",(0,t.jsxs)(n.p,{children:["for i in *;do ctr -n k8s.io i import $i --platform=linux/arm64 ;done #\u5bfc\u5165\u7f51\u7edc\u7ec4\u4ef6\u6240\u9700\u7684\u955c\u50cf\u6587\u4ef6 ",(0,t.jsx)(n.strong,{children:"#\u6240\u6709\u8282\u70b9"})]}),"\n",(0,t.jsx)(n.p,{children:"\u8fc7\u4e00\u4f1a\u513f\u540e\nkubectl get nodes #\u67e5\u770b\u8282\u70b9\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u6240\u6709\u8282\u70b9\u5c31\u7eea\nkubectl get pods --all-namespaces #\u53ef\u4ee5\u770b\u5230\u6240\u6709\u955c\u50cf\u5df2\u8fd0\u884c"}),"\n",(0,t.jsx)(n.h1,{id:"3\u5c0f\u9898\u517c1\u5c0f\u9898\u90e8\u5206\u8981\u6c42",children:"3\u5c0f\u9898\u517c1\u5c0f\u9898\u90e8\u5206\u8981\u6c42"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e00\u6b65\u5bfc\u5165nginx\u955c\u50cf--\u6240\u6709\u8282\u70b9",children:"\u7b2c\u4e00\u6b65\uff1a\u5bfc\u5165nginx\u955c\u50cf--\u6240\u6709\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:"ctr -n k8s.io image import nginx.tar"}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e8c\u6b65\u521b\u5efa\u90e8\u7f72--\u4e3b\u8282\u70b9",children:"\u7b2c\u4e8c\u6b65\uff1a\u521b\u5efa\u90e8\u7f72--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["1\u3001kubectl create deployment web --image=nginx --replicas=2   #\u540d\u79f0\u4e3aweb \u6620\u50cf\u4e3anginx \u526f\u672c\u6570\u4e3a2\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1689083701241-075abcd1-be2f-4a42-a3f0-19d4104a972a.png#averageHue=%230c0a08&clientId=u4a084733-cd49-4&from=drop&id=nN3Ox&originHeight=87&originWidth=1199&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20138&status=done&style=none&taskId=u9608ec35-fe60-4465-bc5e-0b1c29a14b0&title=",alt:"\u622a\u56fe 2023-07-11 21-54-28.png"}),"2\u3001kubectl edit deployment web #\u4f7f\u7528\u7cfb\u7edf\u7f16\u8f91\u5668\u6253\u5f00\u540d\u4e3aweb\u7684\u90e8\u7f72\uff0c\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1689083849741-91a4c8f8-9bc2-4a5e-9574-a1ffd4973b8d.png#averageHue=%230a0907&clientId=u4a084733-cd49-4&from=drop&id=u11ef7b6a&originHeight=79&originWidth=1043&originalType=binary&ratio=1&rotation=0&showTitle=false&size=16638&status=done&style=none&taskId=u46de7775-7243-4a9d-81b4-351ac0818b4&title=",alt:"\u622a\u56fe 2023-07-11 21-57-15.png"}),"\u4fee\u6539imagepullpolicy\u5904\uff0cIfNotPresent\u7684\u4f5c\u7528\u662f\u6307\u5b9a\u4f18\u5148\u4f7f\u7528\u672c\u673a\u7f13\u5b58\u7684\u955c\u50cf\uff0c\u5982\u679c\u672c\u5730\u6ca1\u6709\u5728\u4ece\u4ed3\u5e93\u62c9\u53d6\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1689083855988-e06a206f-4ca5-470a-9053-b509234fc819.png#averageHue=%23080706&clientId=u4a084733-cd49-4&from=drop&id=u47543472&originHeight=360&originWidth=1043&originalType=binary&ratio=1&rotation=0&showTitle=false&size=42263&status=done&style=none&taskId=u31991aca-f977-4a0a-97e0-cc1ff0a1fa7&title=",alt:"\u622a\u56fe 2023-07-11 21-56-54.png"}),"3\u3001kubectl get pod #\u67e5\u770bpod\u4fe1\u606f\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1689084103474-00e4cd82-e82b-477a-94fc-956631ed8f4f.png#averageHue=%230c0a08&clientId=u4a084733-cd49-4&from=drop&id=u2e22d06c&originHeight=157&originWidth=1043&originalType=binary&ratio=1&rotation=0&showTitle=false&size=32799&status=done&style=none&taskId=ubf1a201c-767f-40dd-b7a4-e2171e9704d&title=",alt:"\u622a\u56fe 2023-07-11 21-59-10.png"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e09\u6b65\u6620\u5c04\u7aef\u53e3--\u4e3b\u8282\u70b9",children:"\u7b2c\u4e09\u6b65\uff1a\u6620\u5c04\u7aef\u53e3--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["vim /etc/kubernetes/manifests/kube-apiserver.yaml\n\u6dfb\u52a0\uff1a- --service-node-port-range=1-65535\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2023/png/33622884/1689084131588-873743a2-e00a-45de-9550-0747ab2677d8.png#averageHue=%230e0c0b&clientId=u4a084733-cd49-4&from=drop&id=ub4667159&originHeight=590&originWidth=1217&originalType=binary&ratio=1&rotation=0&showTitle=false&size=105109&status=done&style=none&taskId=u49549a2d-568d-4252-80b7-ed7eaafd8c1&title=",alt:"\u622a\u56fe 2023-07-11 22-01-30.png"}),"systemctl restart kubelet.service #\u91cd\u542fkubelet.service"]}),"\n",(0,t.jsx)(n.p,{children:"kubectl expose deployment web --port=80 --target-port=80 --type=NodePort"}),"\n",(0,t.jsxs)(n.p,{children:["kubectl edit svc web #\u7f16\u8f91\u526f\u672cweb\u7684\u914d\u7f6e\u6587\u4ef6\n#\u4fee\u6539\u4ee5\u4e0b\u5b57\u6bb5\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704787505314-ba64bb47-8952-40c1-917d-29209bda0c10.png#averageHue=%23300a25&clientId=u14b596dc-9e8a-4&from=paste&height=447&id=ub8a7f1c7&originHeight=447&originWidth=663&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73508&status=done&style=none&taskId=u669a4edb-fa6f-4ab8-b636-66181b4baea&title=&width=663",alt:"image.png"}),"\nkubectl get svc #\u67e5\u770b\u670d\u52a1\nkubectl get pod -o wide #\u67e5\u770b\u670d\u52a1\u5668pod\u8be6\u60c5\uff0c\u5728\u54ea\u4e2a\u8282\u70b9\u8fd0\u884c\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704787597421-b3b47a40-937d-484e-a78c-34560cf0ba8c.png#averageHue=%23310b25&clientId=u14b596dc-9e8a-4&from=paste&height=195&id=u70b43bfb&originHeight=195&originWidth=1152&originalType=binary&ratio=1&rotation=0&showTitle=false&size=61163&status=done&style=none&taskId=u9000697f-f78b-4c74-bbcf-bedb9cf9383&title=&width=1152",alt:"image.png"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u56db\u6b65\u4f7f\u7528kubectl\u914d\u7f6enginx--\u4e3b\u8282\u70b9",children:"\u7b2c\u56db\u6b65\uff1a\u4f7f\u7528kubectl\u914d\u7f6enginx--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:['kubectl exec -it web-79f9c88bdc-djtfh bash #\u8fdb\u5165Linux6\u8282\u70b9\necho "HelloKubernetes" > /usr/share/nginx/html/index.html\nnginx -s reload #\u91cd\u542fnginx\ncurl localhost #\u6d4b\u8bd5\u8bbf\u95ee\u60c5\u51b5\n',(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704789048358-ab7d53eb-8ab0-4934-b5d6-34c509f55e19.png#averageHue=%23310c26&clientId=u14b596dc-9e8a-4&from=paste&height=53&id=ud5a303f1&originHeight=53&originWidth=564&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14420&status=done&style=none&taskId=ua9676b95-fb7e-499f-a105-12ae63b7d0d&title=&width=564",alt:"image.png"})]}),"\n",(0,t.jsxs)(n.p,{children:['kubectl exec -it web-79f9c88bdc-vhz4b bash #\u8fdb\u5165Linux7\u8282\u70b9\necho "HelloKubernetes" > /usr/share/nginx/html/index.html\nnginx -s reload #\u91cd\u542fnginx\ncurl localhost #\u6d4b\u8bd5\u8bbf\u95ee\u60c5\u51b5\n',(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704788941342-0cbc5f9d-9738-432d-9af2-04190992d5b1.png#averageHue=%23320c26&clientId=u14b596dc-9e8a-4&from=paste&height=52&id=u7daac201&originHeight=52&originWidth=550&originalType=binary&ratio=1&rotation=0&showTitle=false&size=14402&status=done&style=none&taskId=u726e7065-91ed-430c-958d-83b881520a9&title=&width=550",alt:"image.png"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u7b2c\u4e94\u6b65\u6d4b\u8bd5--\u4e3b\u8282\u70b9",children:"\u7b2c\u4e94\u6b65\uff1a\u6d4b\u8bd5--\u4e3b\u8282\u70b9"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e24\u4e2a\u8282\u70b9\u8bbf\u95ee\u90fd\u6ca1\u95ee\u9898\u540e\uff0c\u4f7f\u7528\u4e3b\u8282\u70b9\u6d4b\u8bd5\u8bbf\u95ee\u60c5\u51b5\n",(0,t.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33622884/1704789171131-c998f7df-45e2-424f-bece-1ad5a20931fe.png#averageHue=%23310c26&clientId=u14b596dc-9e8a-4&from=paste&height=239&id=ued879bc9&originHeight=239&originWidth=602&originalType=binary&ratio=1&rotation=0&showTitle=false&size=56919&status=done&style=none&taskId=ub56a9b91-84df-4015-b728-f2b5f800628&title=&width=602",alt:"image.png"})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);